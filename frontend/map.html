<!DOCTYPE html>
<html>
<head>
	<script src="js/konva.min.js"></script>
	<meta charset="utf-8">
	<title>Map</title>
	<style>
		body {
			margin: 0;
			padding: 0;
			overflow: hidden;
			background-color: #F0F0F0;
		}
	</style>
</head>
<body>
	<div id="map"></div>
	<script>
		var width = window.innerWidth;
		var height = window.innerHeight;
		var data;

		var req_plants = [41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62].toString();
			req_height = "200",
			req_width = "300";

		var http = new XMLHttpRequest();
    http.onreadystatechange = function() {
      if (http.readyState == 4 && http.status == 200) {
        data = JSON.parse(http.responseText);
        dataProcess(data);
      }
    }

    function getData() {
      // Get credits page.
      http.open("POST", "http://localhost:1337/optimize", true);
      http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      http.send("plants="+req_plants+"&height="+req_height+"&width="+req_width);
    }

    getData();
		
		var stage = new Konva.Stage({
			container: 'map',
			width: width,
			height: height
		});
		
		// 
		var groundLayer = new Konva.Layer();
		var plantsLayer = new Konva.Layer();
		
		// Add ground
		var ground = new Konva.Rect   ({
			x: 0,
			y: 0,
			width: width,
			height: height,
			fill: '00AA00',
			opacity: 0.5,
			strokeWidth: 0
		});

		function dataProcess(data) {
			for (var i = data.ground.length - 1; i >= 0; i--) {
				var ground = new Konva.Rect({
					x: Number(data.ground[i].x),
					y: Number(data.ground[i].y),
					width: Number(data.ground[i].width),
					width: Number(data.ground[i].height),
					fill: 'brown',
					stroke: 'black',
					strokeWidth: 2
				});
				// console.log(ground);
				// add the shape to the layer
				plantsLayer.add(ground);
			}
			
			// Add plants
			for (var i = data.plants.length - 1; i >= 0; i--) {
				var plant = new Konva.Circle({
					x: Number(data.plants[i].x),
					y: Number(data.plants[i].y),
					radius: Number(data.plants[i].width/2),
					fill: 'red',
					stroke: 'black',
					opacity: 0.5,
					strokeWidth: 2
				});
				// console.log(plant);
				// add the shape to the layer
				plantsLayer.add(plant);
			}

			// add the layer to the stage
			stage.add(plantsLayer);
		}
	</script>

</body>
</html>